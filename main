import logging
from ai_models import EnhancedAI
from utils import install_playwright, list_files
from git_operations import git_commit_and_push

def generate_human_exe(enhanced_ai, logger):
    logger.info("Generating Human.exe composition...")
    
    # Generate lyrics
    lyrics = enhanced_ai.generate_lyrics("Human.exe", style="humorous", themes=["AI learning human behavior", "misunderstandings", "quirky observations"])
    logger.info(f"Generated lyrics:\n{lyrics}")
    
    # Create sound effects
    sound_effects = enhanced_ai.create_sound_effects(["computer_startup", "error_beep", "digital_glitch", "robot_voice"])
    logger.info(f"Created sound effects: {sound_effects}")
    
    # Generate melody
    melody = enhanced_ai.generate_melody(genre="indie_pop_electronic", style="quirky", tempo=128)
    logger.info(f"Generated melody: {melody}")
    
    # Combine elements into the final composition
    composition = enhanced_ai.combine_elements(lyrics, sound_effects, melody, song_structure="verse_chorus_bridge")
    logger.info(f"Created Human.exe composition: {composition}")
    
    # Export the composition
    export_path = enhanced_ai.export_composition(composition, format="mp3", filename="Human_exe_v1.mp3")
    logger.info(f"Exported composition to: {export_path}")
    
    return composition, export_path

def main():
    # Set up logging
    logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')
    logger = logging.getLogger(__name__)

    logger.info("Synthetic Souls AI Composition Engine started")
    
    # Log all files in the folder
    logger.info("Listing all files in the project folder:")
    list_files()
    
    # Initialize the EnhancedAI with the udioapi token
    udioapi_token = "BcAj2Rir8Y5-vM01R0h8E"
    enhanced_ai = EnhancedAI(udioapi_token)
    
    # Generate Human.exe composition
    composition, export_path = generate_human_exe(enhanced_ai, logger)
    
    # TODO: Implement Nova's visual storytelling for Human.exe
    # visual_story = nova_visual_storytelling(composition, "Human.exe")
    # logger.info(f"Created visual story for Human.exe: {visual_story}")
    
    logger.info("Synthetic Souls AI Composition Engine completed its cycle")

    # Commit and push changes to git
    try:
        git_commit_and_push("Update from Synthetic Souls AI Composition Engine: Created Human.exe composition")
    except Exception as e:
        logger.error(f"Failed to push changes: {str(e)}")
        logger.info("Changes were committed but not pushed. You may need to push manually.")

if __name__ == "__main__":
    main()
